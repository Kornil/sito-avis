webpackJsonp([2],{18:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(0),u=n(s),c=r(25),f=n(c),d=function(e){function t(e){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.shouldDisplayError=r.shouldDisplayError.bind(r),r}return l(t,e),i(t,[{key:"shouldDisplayError",value:function(){return this.props.showError&&this.props.errorText&&(this.props.touched||this.props.submit)}},{key:"render",value:function(){return u.default.createElement("div",{className:"form__field-group"},u.default.createElement("label",{className:"sr-only",htmlFor:this.props.name},this.props.placeholder),u.default.createElement("input",{className:this.shouldDisplayError()?"form__input form__input--error":"form__input",type:this.props.type||"text",placeholder:this.props.placeholder,value:this.props.text,onChange:this.props.handleChange,onBlur:this.props.handleBlur,onFocus:this.props.handleFocus,name:this.props.name,id:this.props.name}),u.default.createElement(f.default,{display:this.shouldDisplayError()},u.default.createElement("div",{className:"form__error-wrap"},u.default.createElement("span",{className:"form__error-content"},this.props.errorText))))}}]),t}(s.Component);t.default=d},25:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),s=function(e){return e&&e.__esModule?e:{default:e}}(i),u=function(e){function t(){return n(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),l(t,[{key:"render",value:function(){return!0===this.props.display?s.default.createElement("div",null,this.props.children):null}}]),t}(i.Component);t.default=u},5:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.skip=t.fieldValidationsModal=t.fieldValidationsPhotoGallery=t.fieldValidations=t.run=t.ruleRunner=t.minLength=t.mustMatch=t.conditionalRequired=t.required=t.cardWidth=t.cropSquare=t.resize=t.sanitizeExcerpt=t.sanitize=t.generateSlug=t.formatDate=t.galleriesDbRef=t.timeRef=t.galleriesRef=t.contattiRef=t.blogsRef=t.rootRef=void 0;var a=r(12),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a),l=r(80),i=function(e){return e&&e.__esModule?e:{default:e}}(l),s={apiKey:"AIzaSyDorzqQG5pgETcGGmQ58DrQhQUHYnVERHU",authDomain:"avis-website-dac6e.firebaseapp.com",databaseURL:"https://avis-website-dac6e.firebaseio.com",projectId:"avis-website-dac6e",storageBucket:"avis-website-dac6e.appspot.com",messagingSenderId:"115042660818"};o.initializeApp(s);var u=t.rootRef=o.database().ref().child("avis"),c=(t.blogsRef=u.child("blogs"),t.contattiRef=u.child("contatti"),t.galleriesRef=u.child("galleries"),t.timeRef=o.database.ServerValue.TIMESTAMP,t.galleriesDbRef=o.storage().ref().child("images/galleries"),t.formatDate=function(e){var t=["genn","febbr","mar","apr","magg","giugno","luglio","ag","sett","ott","nov","dic"];return e.getDate()+" "+t[e.getMonth()]+" "+e.getFullYear()},t.generateSlug=function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},t.sanitize=function(e){return{__html:(0,i.default)(e,{allowedTags:i.default.defaults.allowedTags.concat(["img","span"]),allowedAttributes:{a:["href","name","target"],img:["alt","src"],"*":["style","align"]}})}},t.sanitizeExcerpt=function(e){return{__html:(0,i.default)(e,{allowedTags:["b","i","em","strong","a"],allowedAttributes:{a:["href"]}})}},t.resize=function(e,t){return"http://res.cloudinary.com/avis-rovigo/image/fetch/w_"+e+",c_scale/"+encodeURIComponent(t).replace(/'/g,"%27").replace(/"/g,"%22")},t.cropSquare=function(e,t){return"http://res.cloudinary.com/avis-rovigo/image/fetch/w_"+e+",h_"+e+",c_fill/"+encodeURIComponent(t).replace(/'/g,"%27").replace(/"/g,"%22")},t.cardWidth=function(){return window.innerWidth>600?Math.floor(window.innerWidth/3):window.innerWidth<600&&window.innerWidth>480?Math.floor(window.innerWidth/2):Math.floor(window.innerWidth)},function(e){return e+" is required"}),f=function(e){return function(t){return t+" must match "+e}},d=function(e){return function(t){return t+" must be at least "+e+" characters"}},h=t.required=function(e){return e?null:c},p=(t.conditionalRequired=function(e,t){return function(e,r){return""!==r[t]&&""===e?c:null}},t.mustMatch=function(e,t){return function(r,n){return n[e]===r?null:f(t)}},t.minLength=function(e){return function(t){return t.length>=e?null:d(e)}},t.ruleRunner=function(e,t){for(var r=arguments.length,a=Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];return function(r){var o=a.find(function(t){return t(r[e],r)});return o?n({},e,o(r[e],r)(t)):{}}});t.run=function(e,t){return t.reduce(function(t,r){return Object.assign(t,r(e))},{})},t.fieldValidations=[p("title","Title",h)],t.fieldValidationsPhotoGallery=[p("title","Gallery Name",h)],t.fieldValidationsModal=[p("alt","Alt text",h)],t.skip=function(e){var t=function(e){e.target.removeAttribute("tabindex")},r=document.getElementById(e);r.tabIndex=-1,r.focus(),r.addEventListener("blur",t)}},82:function(e,t){},83:function(e,t){},89:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=r(0),d=n(f),h=r(135),p=n(h),m=r(6),g=r(12),y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(g),v=r(18),b=n(v),w=r(25),_=n(w),E=r(5),P=r(136)(d.default),O={gutter:10,itemSelector:".preview-item"},k=function(e){function t(e){l(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={edit:!1,newGallery:{title:"",images:[],key:""},localFieldValidations:[].concat(o(E.fieldValidationsPhotoGallery)),uploadProgress:{files:[],totalBytes:0,bytesTransferred:0,percentProgress:0},uploading:!1,mainErrorDisplay:"",showErrors:{title:!1},validationErrors:{},touched:{title:!1},submit:!1,componentRef:null},r.onImageDrop=r.onImageDrop.bind(r),r.handleSubmit=r.handleSubmit.bind(r),r.handleChange=r.handleChange.bind(r),r.removeFile=r.removeFile.bind(r),r.handleBlur=r.handleBlur.bind(r),r.errorFor=r.errorFor.bind(r),r.handleFocus=r.handleFocus.bind(r),r}return s(t,e),c(t,[{key:"componentWillMount",value:function(){var e=this;if(this.props.match.params.key){var t=this.props.match.params.key,r=u({},this.state);E.galleriesRef.child(t).once("value",function(t){var n=t.val();r.newGallery=u({},n),r.edit=!0,e.setState(u({},r))})}}},{key:"onImageDrop",value:function(e){var t=this,r=u({},this.state);if(e.some(function(e){return r.newGallery.images.some(function(t){return t.name===e.name})}))return void this.displayMainError("File names must be unique");e.forEach(function(e){t.createFieldValidations(e),r.newGallery.images=[].concat(o(t.state.newGallery.images),[e]),r.validationErrors=(0,E.run)(u({},r.newGallery),t.state.localFieldValidations),t.setState(u({},r))})}},{key:"createFieldValidations",value:function(e){this.setState({localFieldValidations:[].concat(o(this.state.localFieldValidations),[(0,E.ruleRunner)(e.name,"Alt text",E.required)])})}},{key:"errorFor",value:function(e){return this.state.validationErrors[e]?this.state.validationErrors[e]||"":null}},{key:"handleChange",value:function(e){var t=u({},this.state);t.newGallery[e.target.name]=e.target.value,this.setState(u({},t))}},{key:"handleAltText",value:function(e,t){var r=u({},this.state.newGallery.images[t]);r.alt=e.target.value;var n=u({},this.state);n.newGallery.images[t]=u({},r),this.setState(u({},n))}},{key:"handleBlur",value:function(e){var t=e.target.name,r=u({},this.state);r.validationErrors=(0,E.run)(u({},this.state.newGallery),this.state.localFieldValidations),r.validationErrors[t]&&(r.showErrors=u({},this.state.showErrors,a({},t,!0))),r.touched=u({},this.state.touched,a({},t,!0)),this.setState(u({},r))}},{key:"handleFocus",value:function(e){var t=e.target.name,r={validationErrors:(0,E.run)(u({},this.state),this.state.localFieldValidations),showErrors:u({},this.state.showErrors,a({},t,!1)),touched:u({},this.state.touched,a({},t,!1))};this.setState(u({},this.state,r))}},{key:"_updateProgress",value:function(e,t){var r=this.state.uploadProgress.totalBytes,n=[].concat(o(this.state.uploadProgress.files)),l=n.findIndex(function(e){return Object.keys(e)[0]===t});-1===l?(n.push(a({},t,e.bytesTransferred)),r=this.state.uploadProgress.totalBytes+e.totalBytes):n[l][t]=e.bytesTransferred;var i=n.reduce(function(e,t){return e+Object.values(t)[0]},0);this.setState({uploadProgress:{totalBytes:r,files:n,percentProgress:Math.round(i/r*100)}})}},{key:"displayMainError",value:function(e){var t=this;this.setState({mainErrorDisplay:e}),setTimeout(function(){t.componentRef&&t.setState({mainErrorDisplay:""})},2e3)}},{key:"handleSubmit",value:function(e){var t=this;if(e.preventDefault(),0===this.state.newGallery.images.length)return void this.displayMainError("Gallery cannot be empty");var r=u({},this.state,{validationErrors:(0,E.run)(u({},this.state.newGallery),this.state.localFieldValidations),showErrors:{title:!0},submit:!0});this.state.newGallery.images.forEach(function(e){r.showErrors[e.name]=!0}),Object.keys(r.touched).forEach(function(e){r.touched[e]=!0}),this.setState(u({},this.state,r),function(){if(Object.keys(t.state.validationErrors).length>0)return void console.log("validation errors");if(t.state.edit){var e=t.state.newGallery.key;E.galleriesRef.orderByChild("key").equalTo(e).once("value",function(r){return null===r.val()?(console.log("gallery not found"),null):(r.ref.child(e).update(t.state.newGallery).then(function(){t.props.history.push("/galleryindex")}),null)})}var r=E.galleriesRef.push().key;t.setState({uploading:!0});var n=[].concat(o(t.state.newGallery.images)),a=y.storage().ref(),l={images:[],title:t.state.newGallery.title,timestamp:E.timeRef,slug:(0,E.generateSlug)(t.state.newGallery.title),key:r},i=n.map(function(e){var n={customMetadata:{altText:t.state.newGallery[e.name]}},o=a.child("images/galleries/"+r+"/"+e.name).put(e,n);return new Promise(function(r,n){o.on("state_changed",function(r){t._updateProgress(r,e.name)},function(e){console.log(e),n()},function(){l.images.push({fileName:e.name,url:o.snapshot.downloadURL,alt:t.state.newGallery[e.name]}),r()})}).catch(function(e){console.error(e)})});Promise.all(i).then(function(){E.galleriesRef.child(r).set(l).then(function(){t.props.history.push("/galleryindex")})})})}},{key:"removeFile",value:function(e){var t=this,r=e.target.name;this.setState({images:this.state.newGallery.images.filter(function(e){return e.name!==r})},function(){t.setState({localFieldValidations:[].concat(o(E.fieldValidationsPhotoGallery))}),t.state.newGallery.images.forEach(function(e){t.createFieldValidations(e)})})}},{key:"render",value:function(){var e=this,t=void 0;return d.default.createElement("div",{ref:function(t){e.componentRef=t}},d.default.createElement("h2",{className:"newBlog__banner newBlog__banner--crumbs"},"New photo gallery"),d.default.createElement("div",{className:"newBlog__container"},d.default.createElement("form",{className:"newBlog__form"},d.default.createElement(b.default,{placeholder:"Gallery Name",className:"form__input",handleChange:this.handleChange,handleBlur:this.handleBlur,handleFocus:this.handleFocus,name:"title",showError:this.state.showErrors.title,errorText:this.errorFor("title"),touched:this.state.touched.title,text:this.state.newGallery.title}),d.default.createElement(_.default,{display:!!this.state.mainErrorDisplay},d.default.createElement("div",{className:"form__error-wrap"},d.default.createElement("span",{className:"form__error-content"},this.state.mainErrorDisplay))),d.default.createElement(p.default,{style:{height:"200px",width:"100%",borderStyle:"dotted",marginLeft:"5px",marginRight:"auto",textAlign:"center",paddingTop:"20px",marginBottom:"20px"},ref:function(e){t=e},multiple:!0,accept:"image/*",onDrop:this.onImageDrop},d.default.createElement("p",null,"Drop images here")),d.default.createElement("div",{style:{textAlign:"center"}},d.default.createElement("a",{role:"button",tabIndex:"0",onKeyPress:function(e){var r=e.keyCode?e.keyCode:e.which;32!==r&&13!==r||t.open()},className:"newBlog__button newBlog__button--featured",onClick:function(){t.open()}},"Choose File"),d.default.createElement("br",null),d.default.createElement("a",{role:"button",tabIndex:"0",className:"newBlog__button newBlog__button--featured",onClick:this.handleSubmit},this.state.uploading?"Uploading":"Save Gallery"),d.default.createElement(m.Link,{to:"/galleryindex",className:"newBlog__cancel newBlog__button"},"Cancel")),this.state.uploadProgress.percentProgress>0&&d.default.createElement("span",{className:"newBlog__imgProg"},d.default.createElement("span",{className:"newBlog__img-upload-progress"},"Uploading... ",this.state.uploadProgress.percentProgress,"%"))),d.default.createElement("div",{className:"newBlog__preview createGallery__preview"},d.default.createElement("h3",{className:"newBlog__subhead"},"Preview"),d.default.createElement("div",{className:"newBlog__wrapper"},d.default.createElement(P,{options:O},this.state.newGallery.images.map(function(t,r){return d.default.createElement("div",{key:t.preview||t.fileName,className:"preview-item"},d.default.createElement("div",{className:"image-container"},d.default.createElement("div",null,d.default.createElement("img",{className:"preview-image",src:e.state.edit?t.url:t.preview,alt:"preview"}))),d.default.createElement("div",{className:"preview-form-items"},d.default.createElement(b.default,{className:"form__input",type:"text",name:t.name||t.fileName,text:e.state.newGallery.images[r].alt,placeholder:"Alt text for image",handleChange:e.state.edit?function(t){return e.handleAltText(t,r)}:e.handleChange,handleBlur:e.handleBlur,handleFocus:e.handleFocus,showError:e.state.showErrors[t.name],errorText:e.errorFor(t.name),touched:e.state.touched[t.name],submit:e.state.submit}),d.default.createElement("a",{style:{display:"block"},name:t.name,role:"button",tabIndex:"0",className:"removeButton newBlog__button newBlog__button--featured",onClick:e.removeFile},"Remove")))}))))))}}]),t}(f.Component);t.default=k}},[89]);